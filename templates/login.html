{% extends "base.html" %}

{% block title %}AUTHENTICATION_REQUIRED{% endblock %}

{% block content %}
<div class="login-container">
    <div class="login-header">
        <div class="system-prompt">ralph@mode:~/auth$</div>
        <div class="command">./login.sh --oauth</div>
    </div>

    <div class="login-content">
        <div class="status-line">
            <span class="prompt">&gt;</span>
            <span class="status-blink">Initializing authentication protocol...</span>
        </div>

        <div class="status-line">
            <span class="prompt">&gt;</span>
            <span>OAuth provider: <span class="highlight">Google</span></span>
        </div>

        <div class="status-line">
            <span class="prompt">&gt;</span>
            <span>Encryption: <span class="highlight">TLS 1.3</span></span>
        </div>

        <div class="status-line">
            <span class="prompt">&gt;</span>
            <span>Status: <span class="status-ready">READY</span></span>
        </div>

        <div class="oauth-container">
            <div id="g_id_onload"
                 data-client_id="{{ google_client_id }}"
                 data-callback="handleCredentialResponse"
                 data-auto_prompt="false">
            </div>

            <div class="g_id_signin"
                 data-type="standard"
                 data-size="large"
                 data-theme="dark"
                 data-text="sign_in_with"
                 data-shape="rectangular"
                 data-logo_alignment="left">
            </div>
        </div>

        <div class="terminal-input">
            <span class="prompt">ralph@mode:~/auth$</span>
            <span class="cursor-blink">_</span>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_head %}
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
.login-container {
    max-width: 600px;
    margin: 2rem auto;
    padding: 2rem;
    border: 1px solid #00ff00;
    background: #0a0a0a;
}

.login-header {
    border-bottom: 1px solid #00ff00;
    padding-bottom: 1rem;
    margin-bottom: 2rem;
}

.system-prompt {
    color: #00ff00;
    font-family: monospace;
    font-size: 0.9rem;
}

.command {
    color: #ffff00;
    font-family: monospace;
    font-size: 1.1rem;
    margin-top: 0.5rem;
}

.status-line {
    margin: 1rem 0;
    font-family: monospace;
    font-size: 0.9rem;
}

.status-blink {
    animation: blink 1s infinite;
}

.status-ready {
    color: #00ff00;
    font-weight: bold;
}

.highlight {
    color: #00ffff;
}

.oauth-container {
    margin: 2rem 0;
    text-align: center;
}

.terminal-input {
    margin-top: 2rem;
    font-family: monospace;
    font-size: 0.9rem;
}

@keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
}
</style>
{% endblock %}

{% block extra_scripts %}
<script>
function handleCredentialResponse(response) {
    // Send the credential to the backend
    fetch('/auth/callback?credential=' + response.credential, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        }
    })
    .then(response => response.redirected ? window.location.href = response.url : null)
    .catch(error => console.error('Error:', error));
}
</script>
{% endblock %}
